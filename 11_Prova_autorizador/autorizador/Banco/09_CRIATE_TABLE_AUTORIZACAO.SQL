CREATE TABLE TB_AUTORIZACAO (
    COD_AUTORIZACAO  NUMBER(12),
    ORDEM_ITEM       NUMBER(3),
    COD_FARM         NUMBER(6),
    COD_FILI         NUMBER(6),
    CNPJ_FARM        NUMBER(14),
    COD_BENEFICIARIO NUMBER(6),
    COD_PLAS         NUMBER(6),
    CNPJ_PLAS        NUMBER(14),
    COD_PROD         NUMBER(6),
    PRECO_FARM       NUMBER(6,2),
    PRECO_LAB        NUMBER(6,2),
    PRECO_PMC_SAUDE  NUMBER(3),
    PRECO_A_PAGAR    NUMBER(6,2),
    STA_CAPTURA      NUMBER(2),
    DT_AUTORIZACAO   DATE
);


COMMENT ON COLUMN TB_AUTORIZACAO.COD_AUTORIZACAO IS 'SEQUENCIAL UNICO DA AUTORIZACAO';
COMMENT ON COLUMN TB_AUTORIZACAO.ORDEM_ITEM IS 'ORDEM DOS PEDIDOS';
COMMENT ON COLUMN TB_AUTORIZACAO.COD_FARM IS 'FK - TD_FARMACIA';
COMMENT ON COLUMN TB_AUTORIZACAO.COD_FILI IS 'FK - TD_FARMACIA';
COMMENT ON COLUMN TB_AUTORIZACAO.CNPJ_FARM IS 'FK - TD_FARMACIA';
COMMENT ON COLUMN TB_AUTORIZACAO.COD_BENEFICIARIO IS 'FK - TD_BENEFICIARIO';
COMMENT ON COLUMN TB_AUTORIZACAO.COD_PLAS IS 'FK - TD_PLANO_SAUDE';
COMMENT ON COLUMN TB_AUTORIZACAO.CNPJ_PLAS IS 'FK - TD_PLANO_SAUDE';
COMMENT ON COLUMN TB_AUTORIZACAO.COD_PROD IS 'FK - TD_PRODUTO';
COMMENT ON COLUMN TB_AUTORIZACAO.PRECO_FARM IS 'MELHOR PRECO NA FARMACIA';
COMMENT ON COLUMN TB_AUTORIZACAO.PRECO_LAB IS 'MELHOR PRECO NO FORNECEDOR';
COMMENT ON COLUMN TB_AUTORIZACAO.PRECO_PMC_SAUDE IS 'MELHOR PRECO NO PLANO SAUDE';
COMMENT ON COLUMN TB_AUTORIZACAO.PRECO_A_PAGAR IS 'PRECO A PAGAR BENEFICIARIO';
COMMENT ON COLUMN TB_AUTORIZACAO.STA_CAPTURA IS 'STATUS DA CAPTURA - FINALIZACAO DA VENDA';
COMMENT ON COLUMN TB_AUTORIZACAO.DT_AUTORIZACAO IS 'DATA INICIAL DA AUTORIZACAO';

ALTER TABLE TB_AUTORIZACAO
    ADD CONSTRAINT PK_TB_AUTORIZACAO PRIMARY KEY (COD_AUTORIZACAO, ORDEM_ITEM)
    USING INDEX;


ALTER TABLE TB_AUTORIZACAO
ADD CONSTRAINT FK_COD_FARM FOREIGN KEY (COD_FARM, COD_FILI, CNPJ_FARM)
  REFERENCES TB_FARMACIA(COD_FARM, COD_FILI, CNPJ_FARM);


ALTER TABLE TB_AUTORIZACAO
ADD CONSTRAINT FK_COD_BENEFICIARIO_AUT FOREIGN KEY (COD_BENEFICIARIO)
  REFERENCES TB_BENEFICIARIO(COD_BENEFICIARIO);


ALTER TABLE TB_AUTORIZACAO
ADD CONSTRAINT FK_COD_PLAS_AUT FOREIGN KEY (COD_PLAS, CNPJ_PLAS)
  REFERENCES TB_PLANO_SAUDE(COD_PLAS, CNPJ_PLAS);


ALTER TABLE TB_AUTORIZACAO
ADD CONSTRAINT FK_COD_PROD_AUT FOREIGN KEY (COD_PROD)
  REFERENCES TB_PRODUTO(COD_PROD);


CREATE INDEX INX_AUTORIZACAO_DT ON TB_AUTORIZACAO (COD_AUTORIZACAO, DT_AUTORIZACAO);


CREATE INDEX INX_AUTORIZACAO_FARM_DT ON TB_AUTORIZACAO (COD_AUTORIZACAO, COD_FARM, COD_FILI, DT_AUTORIZACAO);


CREATE SEQUENCE SQ_AUTORIZACAO
MINVALUE 1
MAXVALUE 999999999999
START WITH 1
INCREMENT BY 1
NOCACHE;
